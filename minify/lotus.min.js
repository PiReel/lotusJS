var Lotus=function(){};Lotus.Context=function(config,params){this.eventDispatcher=Lotus.EventDispatcherFactory.getInstance().getEventDispatcher(config,params);this.componentMap=new Lotus.ComponentMap(this);this.commandMap=new Lotus.CommandMap(this);this.injector=new Lotus.Injector(this);this.startUp()};Lotus.Context.prototype.startUp=function(){this.mapObjects();this.mapComponents();this.mapCommands();this.mapMediators()};Lotus.Context.prototype.mapComponents=function(){};Lotus.Context.prototype.mapCommands=function(){};Lotus.Context.prototype.mapObjects=function(){};Lotus.Context.prototype.mapMediators=function(){};Lotus.CommandMap=function(context){this.eventFunctionMap={};this.instanceMap={};this.context=context};Lotus.CommandMap.prototype.addCommand=function(eventType,handler,functionName,useSingleton){if(useSingleton===null||useSingleton===undefined){useSingleton=false}if(functionName===null||functionName===undefined){functionName="execute"}if(this.eventFunctionMap[eventType]===null||this.eventFunctionMap[eventType]===undefined){this.eventFunctionMap[eventType]=[]}if(this.hasCommandMap(eventType,handler,functionName)){return}this.eventFunctionMap[eventType].push({eventType:eventType,handler:handler,functionName:functionName,useSingleton:useSingleton});if(useSingleton){if(this.instanceMap[eventType]===null||this.instanceMap[eventType]===undefined){this.instanceMap[eventType]={}}if(this.instanceMap[eventType][handler]===null||this.instanceMap[eventType][handler]===undefined){this.instanceMap[eventType][handler]=new handler(this.context)}}if(!this.context.eventDispatcher.canListen(eventType,this,"routeEventToCommand")){this.context.eventDispatcher.addEventListener(eventType,this,"routeEventToCommand")}};Lotus.CommandMap.prototype.hasCommandMap=function(eventType,handler,functionName){var hasCommand=false;if(this.eventFunctionMap[eventType]!==null&&this.eventFunctionMap[eventType]!==undefined){var mapArray=this.eventFunctionMap[eventType];for(var itemIndex=0;itemIndex<mapArray.length;itemIndex++){var item=mapArray[itemIndex];if(item.handler==handler&&item.functionName==functionName){hasCommand=true;break}}}return hasCommand};Lotus.CommandMap.prototype.removeCommand=function(eventType,handler){if(this.eventFunctionMap[eventType]!==null&&this.eventFunctionMap[eventType]!==undefined){var mapArray=this.eventFunctionMap[eventType];for(var itemIndex=mapArray.length-1;itemIndex>=0;itemIndex--){var item=mapArray[itemIndex];if(item.handler==handler){switch(itemIndex){case 0:mapArray.shift();break;case mapArray.length-1:mapArray.pop();break;default:var head=mapArray.slice(0,itemIndex);var tail=mapArray.slice(itemIndex+1);mapArray=head.concat(tail);break}}}if(this.eventFunctionMap[eventType].length<=0){this.context.eventDispatcher.removeEventListener(eventType,this,"routeEventToCommand");delete this.eventFunctionMap[eventType]}}};Lotus.CommandMap.prototype.removeAllCommands=function(){this.eventFunctionMap={};this.instanceMap={};this.context.eventDispatcher.removeAllEventListeners(this)};Lotus.CommandMap.prototype.routeEventToCommand=function(event){if(this.eventFunctionMap[event.type]!==null&&this.eventFunctionMap[event.type]!==undefined){var mapArray=this.eventFunctionMap[event.type];for(var itemIndex=0;itemIndex<mapArray.length;itemIndex++){var item=mapArray[itemIndex];if(item.useSingleton){this.instanceMap[item.event.type][item.handler][item.functionName]()}else{var instance;if(typeof item.handler==="object"){instance=item.handler}else{instance=new item.handler(this.context)}instance[item.functionName](event)}}}};Lotus.ComponentList=function(){this.instancesByConstructor={};Lavender.ArrayList.prototype.constructor.call(this)};Lavender.ObjectUtils.extend(Lavender.ArrayList,Lotus.ComponentList);Lotus.ComponentList.prototype.addToHash=function(object){if(this.instancesByConstructor[object.constructor]===null||this.instancesByConstructor[object.constructor]===undefined){this.instancesByConstructor[object.constructor]=[]}this.instancesByConstructor[object.constructor].push(object)};Lotus.ComponentList.prototype.removeItemFromHash=function(hash,object){var objects=hash[object.constructor];if(objects===null||objects===undefined||objects.length<1){return}for(var i=0;i<objects.length;i++){if(objects[i]==object){switch(i){case 0:objects.shift();break;case objects.length-1:objects.pop();break;default:var head=objects.slice(0,i);var tail=objects.slice(i+1);hash[object.constructor]=head.concat(tail);break}break}}};Lotus.ComponentList.prototype.addItem=function(object){var index=Lavender.ArrayList.prototype.addItem.call(this,object);this.addToHash(object);return index};Lotus.ComponentList.prototype.clear=function(){Lavender.ArrayList.prototype.clearHash.call(this,this.instancesByConstructor);Lavender.ArrayList.prototype.clear.call(this)};Lotus.ComponentList.prototype.removeItemAt=function(index){var object=this.getItemAt(index);this.removeItemFromHash.call(this,this.instancesByConstructor,object);Lavender.ArrayList.prototype.removeItemAt.call(this,index)};Lotus.ComponentList.prototype.insert=function(object,index){Lavender.ArrayList.prototype.insert.call(this,object,index);this.addToHash(object)};Lotus.ComponentMap=function(context){this.context=context;this.componentInstances=new Lotus.ComponentList;this.tagInstanceToRequestId={}};Lotus.ComponentMap.prototype.success=function(result){var tagInstance=this.tagInstanceToRequestId[result.requestId];var div=document.createElement("div");div.innerHTML=result.resultObj;var template=div.querySelector(tagInstance.getAttribute("template-root"));var clone=document.importNode(template.content,true);var component=clone.querySelector(tagInstance.getAttribute("component-root"));component.lotusComponentInstance=tagInstance.lotusComponentInstance;var host=tagInstance.createShadowRoot();host.appendChild(clone);this.createComponent(component)};Lotus.ComponentMap.prototype.fault=function(fault){console.log(fault);throw new Error("Could not load template. Please check you defined the correct path.")};Lotus.ComponentMap.prototype.addComponent=function(tagInstance,functionConstructor){if(tagInstance.lotusComponentInstance===null||tagInstance.lotusComponentInstance===undefined){tagInstance.lotusComponentInstance=new functionConstructor;this.componentInstances.addItem(tagInstance.lotusComponentInstance)}var src=tagInstance.getAttribute("template-url");if(src!==null&&src!==undefined){var httpService=new Lavender.XhrHttpService;httpService.addResponder(this);httpService.send("GET",src,null,"text/html","html",true);this.tagInstanceToRequestId[httpService.requestId]=tagInstance;return}this.createComponent(tagInstance)};Lotus.ComponentMap.prototype.createComponent=function(tagInstance){tagInstance.lotusComponentInstance.created(tagInstance,this.context)};Lotus.ComponentMap.prototype.mapComponent=function(tagName,extendsTag,functionConstructor){var instance=this;xtag.register(tagName,{"extends":extendsTag,lifecycle:{created:function(){instance.addComponent(this,functionConstructor)},inserted:function(){this.lotusComponentInstance.inserted(this)},removed:function(){this.lotusComponentInstance.removed(this)},attributeChanged:function(){this.lotusComponentInstance.attributeChanged(this)}}})};Lotus.Injector=function(context){this.context=context;this.objectMap={}};Lotus.Injector.prototype.mapObject=function(key,constructor,useSingleton){if(key===null||key===undefined||key.length<=0||typeof key!=="string"){throw new Error("Lotus.Injector.prototype.mapObject: key must be a string with a length greater than 0")}if(constructor===null||constructor===undefined||typeof constructor!=="function"){throw new Error("Lotus.Injector.prototype.mapObject: constructor must be a function")}if(useSingleton===null||useSingleton===undefined){useSingleton=false}this.objectMap[key]={constructor:constructor,useSingleton:useSingleton,instance:null}};Lotus.Injector.prototype.mapSingletonInstance=function(key,instance){if(key===null||key===undefined||key.length<=0||typeof key!=="string"){throw new Error("Lotus.Injector.prototype.mapSingletonInstance: key must be a string with a length greater than 0")}if(instance===null||instance===undefined){throw new Error("Lotus.Injector.prototype.mapSingletonInstance: instance must be defined")}this.objectMap[key]={constructor:null,useSingleton:true,instance:instance}};Lotus.Injector.prototype.inject=function(key){if(this.objectMap[key]!==null&&this.objectMap[key]!==undefined){if(this.objectMap[key].useSingleton){if(this.objectMap[key].instance===null){this.objectMap[key].instance=new this.objectMap[key].constructor}return this.objectMap[key].instance}else{return new this.objectMap[key].constructor}}throw new Error("Lotus.Injector.prototype.getObject: could not find object for key: "+key)};Lotus.BaseCommand=function(context){this.action=null;this.context=context;Lavender.ObjectUtils.mixin(Lavender.AbstractEventDispatcher,Lotus.BaseCommand,this)};Lotus.BaseCommand.prototype.execute=function(event){this.action=this.getAction(event);this.action.addEventListener(Lavender.ActionSuccessEvent.SUCCESS,this.onSuccess);this.action.addEventListener(Lavender.ActionErrorEvent.ERROR,this,"onError");this.action.execute()};Lotus.BaseCommand.prototype.getAction=function(event){return null};Lotus.BaseCommand.prototype.onSuccess=function(event){};Lotus.BaseCommand.prototype.onError=function(event){this.destroy();if(console!==null&&console!==undefined){console.log("Lotus.BaseCommand.prototype.onError: "+event.payload.message)}};Lotus.BaseCommand.prototype.destroy=function(){if(this.canListen(Lavender.ActionErrorEvent.ERROR,this,"onError")){this.removeEventListener(Lavender.ActionErrorEvent.ERROR,this,"onError")}if(this.canListen(Lavender.ActionSuccessEvent.SUCCESS,this,"onSuccess")){this.removeEventListener(Lavender.ActionSuccessEvent.SUCCESS,this,"onSuccess")}this.action=null;this.context=null};Lotus.EventDispatcherFactory=function(){if(Lotus.EventDispatcherFactory.instance!=null){throw"Lotus.EventDispatcherFactory.instance: Singleton class has already been instantiated"}else{}};Lotus.EventDispatcherFactory.getInstance=function(){if(Lotus.EventDispatcherFactory.instance==null){Lotus.EventDispatcherFactory.instance=new Lotus.EventDispatcherFactory}return Lotus.EventDispatcherFactory.instance};Lotus.EventDispatcherFactory.instance=null;Lotus.EventDispatcherFactory.prototype.getEventDispatcher=function(config,params){var dispatcher;switch(config.eventDispatcherCode){case"jquery":dispatcher=new Lavender.JqueryEventDispatcher;break;case"angular":dispatcher=new Lavender.AngularEventDispatcher(params);break;case"abstract":default:dispatcher=new Lavender.AbstractEventDispatcher}return dispatcher};Lotus.HttpServiceFactory=function(){if(Lotus.HttpServiceFactory.instance!=null){throw"Lotus.EventDispatcherFactory.instance: Singleton class has already been instantiated"}else{}};Lotus.HttpServiceFactory.getInstance=function(){if(Lotus.HttpServiceFactory.instance==null){Lotus.HttpServiceFactory.instance=new Lotus.HttpServiceFactory}return Lotus.HttpServiceFactory.instance};Lotus.HttpServiceFactory.instance=null;Lotus.HttpServiceFactory.prototype.getHttpService=function(config){var httpService;switch(config.httpServiceCode){case"angular":httpService=new Lavender.AngularHttpService;break;case"jquery":httpService=new Lavender.JqueryHttpService;break;default:httpService=new Lavender.XhrHttpService;break}return httpService};Lotus.SerializeFactory=function(){if(Lotus.SerializeFactory.instance!=null){throw"Lotus.EventDispatcherFactory.instance: Singleton class has already been instantiated"}else{}};Lotus.SerializeFactory.prototype.getServiceResultParser=function(config){var parser;switch(config.parserCode){case"local":case"remote":default:parser={};break}return parser};Lotus.SerializeFactory.prototype.getServiceExporter=function(config){var exporter;switch(config.exporterCode){case"local":case"remote":default:exporter={};break}return exporter};Lotus.SerializeFactory.getInstance=function(){if(Lotus.SerializeFactory.instance==null){Lotus.SerializeFactory.instance=new Lotus.SerializeFactory}return Lotus.SerializeFactory.instance};Lotus.SerializeFactory.instance=null;Lotus.ServiceFactory=function(){if(Lotus.ServiceFactory.instance!=null){throw"Lotus.EventDispatcherFactory.instance: Singleton class has already been instantiated"}else{}};Lotus.ServiceFactory.getInstance=function(){if(Lotus.ServiceFactory.instance==null){Lotus.ServiceFactory.instance=new Lotus.ServiceFactory}return Lotus.ServiceFactory.instance};Lotus.ServiceFactory.instance=null;Lotus.ServiceFactory.prototype.getService=function(config){var dao;switch(config.serviceCode){case"1.0":case"1.1":case"2.50.4878.21250":default:dao=new Lotus.SampleService(config)}return dao};Lotus.SkinPart=function(label,instance,attribute){if(label===null||label===undefined){throw new Error("Lotus.SkinPart.prototype.constructor: label is required")}var _label=label;var _attribute=attribute;var _instance=instance;this.addProperties({label:{get:function(){return _label}},element:{get:function(){return _instance[_attribute]},set:function(val){_instance[_attribute]=val;this.Notify(val,"element")}}});Lavender.Subject.prototype.constructor.call(this)};Lavender.ObjectUtils.extend(Lavender.Subject,Lotus.SkinPart);Lotus.SkinPartList=function(){this.skinPartsByLabel={};Lavender.ArrayList.prototype.constructor.call(this)};Lavender.ObjectUtils.extend(Lavender.ArrayList,Lotus.SkinPartList);Lotus.SkinPartList.prototype.validateItem=function(object){if(object instanceof Lotus.SkinPart===false){throw Error("Lotus.SkinPartList.prototype.addItem: object must be of type Lotus.SkinPart")}};Lotus.SkinPartList.prototype.addItem=function(object){var index=Lavender.ArrayList.prototype.addItem.call(this,object);this.skinPartsByLabel[object.label]=object;return index};Lotus.SkinPartList.prototype.clear=function(){Lavender.ArrayList.prototype.clearHash.call(this,this.skinPartsByLabel);Lavender.ArrayList.prototype.clear.call(this)};Lotus.SkinPartList.prototype.removeItemAt=function(index){var skinPart=this.getItemAt(index);Lavender.ArrayList.prototype.removeItemFromHash.call(this,this.skinPartsByLabel,skinPart.label);Lavender.ArrayList.prototype.removeItemAt.call(this,index)};Lotus.SkinPartList.prototype.insert=function(object,index){Lavender.ArrayList.prototype.insert.call(this,object,index);this.skinPartsByLabel[object.label]=object};Lotus.AbstractComponent=function(){var _element;var _context;var _id=Math.random();var _skinParts=new Lotus.SkinPartList;Lavender.Subject.prototype.constructor.call(this);this.addProperties({element:{get:function(){return _element},set:function(val){_element=val;this.Notify(val,"element")}},context:{get:function(){return _context},set:function(val){_context=val;this.Notify(val,"context")}},id:{get:function(){return _id},set:function(val){_id=val;this.Notify(val,"id")}},skinParts:{get:function(){return _skinParts},set:function(val){_skinParts=val;this.Notify(val,"skinParts")}}});Lavender.ObjectUtils.mixin(Lavender.AbstractEventDispatcher,Lotus.AbstractComponent,this);console.log("Lotus.AbstractComponent.prototype.constructor")};Lavender.ObjectUtils.extend(Lavender.Subject,Lotus.AbstractComponent);Lotus.AbstractComponent.prototype.init=function(){this.defineSkinParts();this.addSkinParts();this.addAttributes()};Lotus.AbstractComponent.prototype.addAttributes=function(){for(var i=0;i<this.element.attributes.length;i++){var attribute=this.element.attributes[i];if(attribute.name.indexOf("attribute-")>=0){var index=attribute.name.indexOf("attribute-")+10;var newProp=attribute.name.substring(index);var camelCased=newProp.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()});if(this.hasOwnProperty(camelCased)){this[camelCased]=attribute.value}}}};Lotus.AbstractComponent.prototype.addSkinParts=function(){if(this.element.getAttribute("skin-part")!==null&&this.element.getAttribute("skin-part")!==undefined){this.addSkinPart(this.element.getAttribute("skin-part"),this.element)}var skinPartsNodeList=this.element.querySelectorAll("[skin-part]");for(var i=0;i<skinPartsNodeList.length;i++){this.addSkinPart(skinPartsNodeList[i].getAttribute("skin-part"),skinPartsNodeList[i])}};Lotus.AbstractComponent.prototype.created=function(element,context){console.log("Lotus.AbstractComponent.prototype.created");this.element=element;this.context=context;this.init()};Lotus.AbstractComponent.prototype.inserted=function(element){console.log("Lotus.AbstractComponent.prototype.inserted")};Lotus.AbstractComponent.prototype.removed=function(element){console.log("Lotus.AbstractComponent.prototype.removed");this.destroy()};Lotus.AbstractComponent.prototype.attributeChanged=function(element){console.log("Lotus.AbstractComponent.prototype.attributeChanged")};Lotus.AbstractComponent.prototype.addSkinPart=function(part,element){if(this.skinParts.skinPartsByLabel[part]===null||this.skinParts.skinPartsByLabel[part]===undefined){return null}this.skinParts.skinPartsByLabel[part].element=element;this.onSkinPartAdded(part,this.skinParts.skinPartsByLabel[part])};Lotus.AbstractComponent.prototype.onSkinPartAdded=function(part,element){};Lotus.AbstractComponent.prototype.defineSkinParts=function(){};Lotus.AbstractComponent.prototype.addEventListeners=function(){};Lotus.AbstractComponent.prototype.removeEventListeners=function(){};Lotus.AbstractComponent.prototype.destroy=function(){this.removeEventListeners();this.binder.unbindAll();this.element=null;this.context=null;this.id=null};Lotus.AbstractCollectionView=function(){var _collection;var _itemView;var _childViews=new Lavender.ArrayList;Lotus.AbstractComponent.prototype.constructor.call(this);this.addProperties({collection:{get:function(){return _collection},set:function(val){_collection=val;if(_collection!==null&&_collection!==undefined){_collection.addEventListener(Lavender.CollectionEvent.COLLECTION_CHANGE,this,"onCollectionChange")}this.Notify(val,"collection")}},itemView:{get:function(){return _itemView},set:function(val){_itemView=val;this.Notify(val,"itemView")}},childViews:{get:function(){return _childViews}}});this.destoryChildViews=function(){for(var i=0;i<_childViews.length;i++){this.removeChildView(_childViews[i])}_childViews=null}};Lavender.ObjectUtils.extend(Lotus.AbstractComponent,Lotus.AbstractCollectionView);Lotus.AbstractCollectionView.prototype.init=function(){Lotus.AbstractComponent.prototype.init.call(this);this.collection=this.getCollection();this.render()};Lotus.AbstractCollectionView.prototype.render=function(){if(this.itemView===null||this.itemView==undefined){throw Error("attribute-item-view must be defined on the tag instance and point to a valid constructor")}for(var i=0;i<this.collection.length;i++){this.addChildView(this.collection.getItemAt(i))}};Lotus.AbstractCollectionView.prototype.defineSkinParts=function(){this.skinParts.addItem(new Lotus.SkinPart("collectionContainer",this,"collectionContainer"));this.skinParts.addItem(new Lotus.SkinPart("itemTemplate",this,"itemTemplate"))};Lotus.AbstractCollectionView.prototype.onSkinPartAdded=function(part,skinPart){switch(part){case"collectionContainer":break;case"itemTemplate":this.itemTemplate=skinPart.element;this.itemTemplate.parentNode.removeChild(this.itemTemplate);break}};Lotus.AbstractCollectionView.prototype.getCollection=function(event){return new Lavender.ArrayList};Lotus.AbstractCollectionView.prototype.onCollectionChange=function(event){switch(event.payload.type){case"add":this.addChildView(event.payload.item);break;case"remove":this.removeChildViewFromModel(event.payload.item);break;case"removeAll":this.removeAllChildViews();break}};Lotus.AbstractCollectionView.prototype.createChildView=function(model){var evalClass=eval(this.itemView);return new evalClass};Lotus.AbstractCollectionView.prototype.addChildView=function(model){var view=this.createChildView(model);var clone=this.itemTemplate.cloneNode(true);view.model=model;view.element=clone;view.init();this.childViews.addItem(view);if(this.collectionContainer!==null&&this.collectionContainer!==undefined){this.collectionContainer.appendChild(view.element)}else{this.element.appendChild(view.element)}};Lotus.AbstractCollectionView.prototype.addAllChildViews=function(models){for(var i=0;i<models.length;i++){this.addChildView(models[i])}};Lotus.AbstractCollectionView.prototype.removeAllChildViews=function(){for(var i=this.childViews.length()-1;i>=0;i--){this.removeChildView(this.childViews.getItemAt(i))}};Lotus.AbstractCollectionView.prototype.removeChildView=function(view){this.removeElement(view.element);view.destroy();this.childViews.removeItemAt(this.childViews.indexOf(view))};Lotus.AbstractCollectionView.prototype.removeElement=function(element){if(this.collectionContainer!==null&&this.collectionContainer!==undefined){this.collectionContainer.removeChild(element)}else{this.element.removeChild(element)}};Lotus.AbstractCollectionView.prototype.removeChildViewFromModel=function(model){for(var i=0;i<this.childViews.length();i++){if(this.childViews.getItemAt(i).model==model){this.removeChildView(this.childViews.getItemAt(i));break}}};Lotus.AbstractCollectionView.prototype.destroy=function(){Lotus.AbstractComponent.prototype.destroy.call(this);if(this.collectionContainer!==null&&this.collectionContainer!==undefined){while(this.collectionContainer.firstChild){this.collectionContainer.removeChild(this.collectionContainer.firstChild)}}else{while(this.element.firstChild){this.element.removeChild(this.firstChild)}}this.destoryChildViews();this.collection=null;this.itemView=null;this.collectionContainer=null;this.itemTemplate=null};Lotus.AbstractItemView=function(){var _model;Lotus.AbstractComponent.prototype.constructor.call(this);this.addProperties({model:{get:function(){return _model},set:function(val){_model=val;this.Notify(val,"model")}}})};Lavender.ObjectUtils.extend(Lotus.AbstractComponent,Lotus.AbstractItemView);Lotus.AbstractItemView.prototype.destroy=function(){Lotus.AbstractComponent.prototype.destroy.call(this);this.model=null};Lotus.Button=function(){var _buttonSkinPart;var _type;this.clickProxy=this.onClick.bind(this);this.addProperties({type:{get:function(){return _type},set:function(val){_type=val;this.Notify(val,"type")}},buttonSkinPart:{get:function(){return _buttonSkinPart},set:function(val){_buttonSkinPart=val;this.Notify(val,"buttonSkinPart")}}});Lotus.AbstractComponent.prototype.constructor.call(this)};Lavender.ObjectUtils.extend(Lotus.AbstractComponent,Lotus.Button);Lotus.Button.prototype.defineSkinParts=function(){this.skinParts.addItem(new Lotus.SkinPart("button",this,"buttonSkinPart"))};Lotus.Button.prototype.created=function(element,context){console.log("Lotus.Button.prototype.created");Lotus.AbstractComponent.prototype.created.call(this,element,context)};Lotus.Button.prototype.onSkinPartAdded=function(part,skinPart){switch(part){case"button":console.log("Lotus.Button.prototype.onSkinPartAdded: part: "+part);console.log("Lotus.Button.prototype.onSkinPartAdded: skinPart: "+skinPart);this.addEventListeners();break}};Lotus.Button.prototype.addEventListeners=function(){Lotus.AbstractComponent.prototype.addEventListeners.call(this);this.buttonSkinPart.addEventListener("click",this.clickProxy)};Lotus.Button.prototype.removeEventListeners=function(){Lotus.AbstractComponent.prototype.removeEventListeners.call(this);this.buttonSkinPart.removeEventListener("click",this.clickProxy)};Lotus.Button.prototype.onClick=function(event){console.log("Lotus.Button.prototype.onClick: event is "+event);console.log("Lotus.Button.prototype.onClick: my id is "+this.id)};
//# sourceMappingURL=/Users/dsmiley/workspace/lotusJS/minify/lotus.min.js.map